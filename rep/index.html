<html>
    <head>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2196f3" />

    
  </head>
<body>

 <button onclick="syncAll()">ğŸ”„ Sync Everything</button>
  <script>
async function syncAll() {
  log('ğŸ” Starting full sync...');
  const db = await dbPromise;

  // Step 1: Send any offline messages to the server
  const offlineMessages = await db.getAll('messages');
  for (const msg of offlineMessages) {
    try {
      await sendToServer(msg);
      await db.delete('messages', msg.id);
      log(`âœ… Synced offline message: ${msg.message}`);
    } catch (err) {
      log(`âŒ Failed to sync: ${msg.message}`);
    }
  }

  // Step 2: Fetch all updates from server
  try {
    const res = await fetch('https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec');
    const serverData = await res.json();

    // Step 3: Replace or merge with IndexedDB
    const tx = db.transaction('messages', 'readwrite');
    const store = tx.objectStore('messages');

    await store.clear(); // optional: replace everything
    for (const row of serverData) {
      await store.put({ id: row[0], message: row[1], timestamp: row[2] });
    }

    log(`ğŸ“¥ Pulled ${serverData.length} messages from server`);
  } catch (err) {
    log('âŒ Could not fetch server data');
    console.error(err);
  }

  log('âœ… Full sync complete!');
}

  </script>
</body>
